#!/usr/bin/env python3 """ Script to start Qwen2.5-7B LLM Service """ import subprocess import sys import time import requests import os def check_service_health(url: str, max_retries: int = 30) -> bool: """Check if service is healthy""" for i in range(max_retries): try: response = requests.get(f"{url}/health", timeout=5) if response.status_code == 200: data = response.json() print(f"LLM Service is healthy!") print(f" Model: {data.get('model', 'Unknown')}") print(f" Device: {data.get('device', 'Unknown')}") print(f" Loaded: {data.get('model_loaded', False)}") return True except: pass print(f"Waiting for LLM Service... ({i+1}/{max_retries})") time.sleep(2) print("ERROR: LLM Service failed to start") return False def main(): """Main function to start LLM service""" print("Starting Qwen2.5-7B LLM Service") print("=" * 50) # Check if requirements are installed try: import torch import transformers import fastapi print("All dependencies found") except ImportError as e: print(f"Missing dependency: {e}") print("Please run: pip install -r llm_requirements.txt") return # Check GPU availability if torch.cuda.is_available(): gpu_memory = torch.cuda.get_device_properties(0).total_memory / 1024**3 print(f"GPU available: {gpu_memory:.1f}GB") else: print("WARNING: No GPU detected, using CPU (slower)") # Start the service try: print("Starting LLM Service on port 8009...") process = subprocess.Popen([ sys.executable, "llm_service.py" ], cwd=os.path.dirname(os.path.abspath(__file__))) # Wait for service to be ready time.sleep(5) # Check health if check_service_health("http://localhost:8009"): print("\nLLM Service is ready!") print("Available at: http://localhost:8009") print("Test endpoint: http://localhost:8009/test") print("Vietnamese test: http://localhost:8009/vietnamese-test") print("\nPress Ctrl+C to stop the service") # Keep the script running try: process.wait() except KeyboardInterrupt: print("\nStopping LLM Service...") process.terminate() print("Service stopped") else: print("ERROR: Failed to start LLM Service") process.terminate() except Exception as e: print(f"ERROR: Failed to start service: {e}") if __name__ == "__main__": main() 