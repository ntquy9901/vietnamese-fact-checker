#!/usr/bin/env python3 """ Script to start Decomposer Service """ import subprocess import sys import time import requests import os def check_service_health(url: str, max_retries: int = 30) -> bool: """Check if service is healthy""" for i in range(max_retries): try: response = requests.get(f"{url}/health", timeout=5) if response.status_code == 200: data = response.json() print("Decomposer Service is healthy!") print(f" LLM Service: {data.get('llm_service', {}).get('status', 'Unknown')}") print(f" Capabilities: {', '.join(data.get('capabilities', []))}") return True except: pass print(f"Waiting for Decomposer Service... ({i+1}/{max_retries})") time.sleep(2) print("ERROR: Decomposer Service failed to start") return False def check_llm_service(url: str = "http://localhost:8009") -> bool: """Check if LLM service is running""" try: response = requests.get(f"{url}/health", timeout=5) if response.status_code == 200: data = response.json() print(f"LLM Service is ready!") print(f" Model: {data.get('model', 'Unknown')}") print(f" Device: {data.get('device', 'Unknown')}") print(f" Loaded: {data.get('model_loaded', False)}") return True except: print("ERROR: LLM Service is not running") return False def main(): """Main function to start Decomposer service""" print("Starting Decomposer Service") print("=" * 50) # Check if LLM service is running if not check_llm_service(): print("WARNING: LLM Service is not running. Please start it first:") print(" python start_llm_service.py") return # Check if requirements are available try: import fastapi import uvicorn import requests print("All dependencies found") except ImportError as e: print(f"Missing dependency: {e}") print("Please run: pip install fastapi uvicorn requests") return # Start the service try: print("Starting Decomposer Service on port 8006...") process = subprocess.Popen([ sys.executable, "decomposer_service.py" ], cwd=os.path.dirname(os.path.abspath(__file__))) # Wait for service to be ready time.sleep(5) # Check health if check_service_health("http://localhost:8006"): print("\nDecomposer Service is ready!") print("Available at: http://localhost:8006") print("Test endpoint: http://localhost:8006/test") print("Vietnamese test: http://localhost:8006/vietnamese-test") print("Decompose endpoint: http://localhost:8006/decompose") print("\nPress Ctrl+C to stop the service") # Keep the script running try: process.wait() except KeyboardInterrupt: print("\nStopping Decomposer Service...") process.terminate() print("Service stopped") else: print("Failed to start Decomposer Service") process.terminate() except Exception as e: print(f"ERROR: Failed to start service: {e}") if __name__ == "__main__": main() 